<!DOCTYPE html>
<html lang="sv">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Canvas animations template</title>
    <style>
        body {
            background-color: rgb(0, 0, 0);
        }
        
        canvas {
            width: 1000px;
            height: 600px;
            background-color: rgb(50, 50, 50);
        }
    </style>

</head>

<body>

    <canvas width="1000" height="600"></canvas>

    <div>
        <button id="start">Start</button>
        <button id="stop">Stop</button>
    </div>


    <script>
        /* variabler
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        _______________________________________*/

        // ange en variabel för canvas elementet
        const canvas = document.querySelector("canvas");

        // ange en variabel för canvas elementets innehåll
        const ctx = canvas.getContext("2d");

        // start knapp
        const startButton = document.querySelector("#start");

        // stop knapp
        const stopButton = document.querySelector("#stop");

        // aktuell frame i animationen
        let frameId = 0;

        /*______Hantera Tagenbortet_______________*/

        var keyboard = {};

        //Ange förvalda egenskaper

        keyboard.up = false;
        keyboard.down = false;
        keyboard.right = false;
        keyboard.left = false;

        let player = {};
        player.x = canvas.width / 2;
        player.y = canvas.height / 2;
        player.vx = 5;
        player.vy = 5;

        player.draw = function() {

            ctx.beginPath();
            ctx.fillStyle = "blue";
            ctx.arc(player.x, player.y, 35, 0, Math.PI, false);
            ctx.fill();
        }

        player.move = function() {
            if (keyboard.up) {
                player.y -= player.vy;
            }
            if (keyboard.down) {
                player.y += player.vy;
            }
            if (keyboard.right) {
                player.x += player.vx;
            }
            if (keyboard.left) {
                player.x -= player.vx;
            }
            player.draw();
        }

        player.draw();

        //Musik för spelet.

        let music = new Sound("rain.mp3")



        /* händelselyssnare
        __________________________________________*/

        startButton.addEventListener("click", function() {
            this.setAttribute("disabled", "disabeled");
            nextFrame();
            music.play();
        })

        stopButton.addEventListener("click", function() {
            cancelAnimationFrame(frameId);
            startButton.removeAttribute("disabled");
        })

        canvas.addEventListener("click", function(event) {
            let mouse = getMousePosition(event);
        });

        document.addEventListener("keydown", getKeyDown, false);
        document.addEventListener("keyup", getKeyUp, false);




        /* funktioner
        ___________________________________________*/

        /**
         * Funktion för gameloop 
         *
         */
        function nextFrame() {

            // använd requestAnimationFrame()
            frameId = requestAnimationFrame(nextFrame);


            // radera pixlar som finns i canvas elementet
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // tangentbord och mus

            // logik

            // rendera
            player.move();


        };

        /**
         * Funktion för musposition
         *
         * @param {object} event
         * @returns object
         */
        function getMousePosition(event) {

            let canvasRectangle = canvas.getBoundingClientRect();
            return {
                x: event.clientX - canvasRectangle.left,
                y: event.clientY - canvasRectangle.top
            };
        }

        /**
         * Funktion för att slumpa heltal
         *
         * @param {number} min
         * @param {number} max
         * @returns number
         */
        function getRandomBetween(min, max) {
            let number = Math.random() * (max - min + 1) + min;
            return Math.floor(number);
        }

        function getKeyDown(event) {
            //  console.log(event);
            if (event.code === "ArrowDown") {
                keyboard.down = true;

            }
            if (event.code === "ArrowUp") {
                keyboard.up = true;
            }

            if (event.code === "ArrowLeft") {
                keyboard.left = true;
            }

            if (event.code === "ArrowRight") {
                keyboard.right = true;
            }
            console.log(keyboard);
        };




        function getKeyUp(event) {
            //  console.log(event);
            if (event.code === "ArrowDown") {
                keyboard.down = true;

            }
            if (event.code === "ArrowUp") {
                keyboard.up = true;
            }

            if (event.code === "ArrowLeft") {
                keyboard.left = true;
            }

            if (event.code === "ArrowRight") {
                keyboard.right = true;
            }
            console.log(keyboard);
        };

        //en konstrukturfunktion för att ljudspel. 
        function Sound(src) {
            this.audio = document.createElement("audio");
            this.audio.src = src;
            this.audio.setAttribute("preload", "auto");
            // this.audio.setAttribute("controls", "controls");
            document.body.append(this.audio);
            this.play = function() {
                this.audio.play();
            }
            this.pause = function() {
                this.audio.pause();
            }
        }
    </script>

</body>

</html>